<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Create wallpaper QR Code</title>
    <!-- Nh√∫ng Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Nh√∫ng th∆∞ vi·ªán QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Nh√∫ng th∆∞ vi·ªán html2canvas ƒë·ªÉ ch·ª•p ·∫£nh tr·ªçn v·∫πn h√¨nh n·ªÅn -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Font ch·ªØ hi·ªán ƒë·∫°i -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        'cyber-bg': '#050505',      /* N·ªÅn ƒëen s√¢u th·∫≥m */
                        'cyber-green': '#86efac',   /* Xanh l√° m·∫° ph√°t s√°ng */
                        'cyber-neon': '#4ade80',    /* Xanh neon m·∫°nh h∆°n */
                        'cyber-purple': '#9333ea',  /* T√≠m c·ªßa sticker */
                        'card-bg': 'rgba(255, 255, 255, 0.03)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* ‚ùÄ Hi·ªáu ·ª©ng h·∫°t b·ª•i kh√¥ng gian (Cyber Particles) */
        .particles-bg {
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(74, 222, 128, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 85% 30%, rgba(74, 222, 128, 0.05) 0%, transparent 40%);
            z-index: 0;
            pointer-events: none;
        }

        /* ‚ùÄ L∆∞·ªõi ma tr·∫≠n m·ªù ·∫£o ph√≠a sau */
        .matrix-grid {
            position: absolute;
            inset: 0;
            background-image: linear-gradient(rgba(74, 222, 128, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(74, 222, 128, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            z-index: 0;
        }

        /* ‚ùÄ Khu v·ª±c Khung H√¨nh N·ªÅn Kh√≥a (Phone Wallpaper Ratio) */
        #wallpaper-preview {
            aspect-ratio: 9 / 19.5;
            /* T·ªâ l·ªá m√†n h√¨nh ƒëi·ªán tho·∫°i hi·ªán ƒë·∫°i */
            width: 100%;
            max-width: 340px;
            position: relative;
            background-color: #080a08;
            border-radius: 2.5rem;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(74, 222, 128, 0.1);
            display: none;
            /* Ban ƒë·∫ßu ·∫©n ƒëi */
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #wallpaper-preview.show {
            display: block;
            transform: scale(1);
            opacity: 1;
        }

        /* ‚ùÄ T·∫•m th·∫ª trong su·ªët (Glass Card) c√≥ v·∫øt c·∫Øt (notch) nh∆∞ thi·∫øt k·∫ø anh g·ª≠i */
        .glass-card {
            background: rgba(20, 30, 20, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(74, 222, 128, 0.15);
            border-radius: 2rem;
            position: relative;
        }

        /* V·∫øt c·∫Øt (Notch) m√¥ ph·ªèng ·ªü c·∫°nh tr√™n c·ªßa th·∫ª */
        .card-notch {
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 20px;
            background: #080a08;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            border-bottom: 1px solid rgba(74, 222, 128, 0.15);
            border-left: 1px solid rgba(74, 222, 128, 0.15);
            border-right: 1px solid rgba(74, 222, 128, 0.15);
        }

        /* ‚ùÄ Ph√©p thu·∫≠t t·∫°o h√†o quang ph√°t s√°ng nh·ªãp nh√†ng (Neon Pulse Glow) ‚ùÄ */
        @keyframes neonGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 3px rgba(134, 239, 172, 0.4)) drop-shadow(0 0 10px rgba(134, 239, 172, 0.2));
            }

            50% {
                filter: drop-shadow(0 0 8px rgba(134, 239, 172, 1)) drop-shadow(0 0 25px rgba(134, 239, 172, 0.7));
            }
        }

        /* √âp m√£ QR ph·ªß k√≠n container */
        #qrcode img,
        #qrcode canvas {
            width: 100% !important;
            height: auto !important;
            border-radius: 12px;
            /* ‚ùÄ Trang kho√°c chi·∫øc √°o ph√°t s√°ng cho m√£ QR ·ªü ƒë√¢y ·∫° ‚ùÄ */
            animation: neonGlow 2.5s infinite ease-in-out;
        }

        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="text-white w-full">

    <div class="particles-bg"></div>
    <div class="matrix-grid"></div>

    <div
        class="w-full max-w-[400px] mx-auto min-h-[100dvh] flex flex-col p-6 relative z-10 items-center justify-center">

        <!-- ========================================== -->
        <!-- M√ÄN H√åNH 1: KHU V·ª∞C NH·∫¨P LI·ªÜU B·∫ÆT ƒê·∫¶U       -->
        <!-- ========================================== -->
        <div id="input-section" class="w-full flex flex-col items-center transition-all duration-500">
            <h1
                class="text-4xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-cyber-green to-white text-center">
                QR SCAN
            </h1>
            <p class="text-gray-400 text-sm mb-10 text-center">Nh·∫≠p m√£ sinh vi√™n ƒë·ªÉ t·∫°o h√¨nh n·ªÅn kh√≥a</p>

            <div class="w-full relative mb-6">
                <input type="text" id="studentId" placeholder="Nh·∫≠p m√£ sinh vi√™n..."
                    class="w-full bg-[#111] text-white text-lg rounded-2xl px-6 py-4 text-center focus:outline-none focus:ring-2 focus:ring-cyber-green transition-all font-medium border border-white/10 placeholder:text-gray-600">
                <p id="errorMessage"
                    class="absolute -top-6 left-0 w-full text-center text-cyber-neon text-xs opacity-0 transition-opacity font-semibold">
                    ‚ùÄ H√£y nh·∫≠p th√¥ng tin v√†o
                </p>
            </div>

            <button onclick="generateWallpaper()"
                class="w-full bg-cyber-green hover:bg-cyber-neon active:scale-95 text-[#050505] rounded-full py-4 text-[17px] font-bold tracking-wide transition-all duration-300 flex items-center justify-center gap-2 shadow-[0_0_20px_rgba(74,222,128,0.3)]">
                Create Wallpaper
            </button>
        </div>

        <!-- ========================================== -->
        <!-- M√ÄN H√åNH 2: KHUNG PREVIEW H√åNH N·ªÄN KH√ìA    -->
        <!-- (Khu v·ª±c n√†y s·∫Ω ƒë∆∞·ª£c ch·ª•p l·∫°i b·∫±ng html2canvas) -->
        <!-- ========================================== -->
        <div id="wallpaper-wrapper" class="w-full flex flex-col items-center hidden">

            <!-- ƒê√¢y l√† b·∫£n th·ªÉ h√¨nh n·ªÅn s·∫Ω ƒë∆∞·ª£c ch·ª•p -->
            <div id="wallpaper-preview" class="mb-6 relative">
                <!-- N·ªÅn c·ªßa ƒëi·ªán tho·∫°i (h·ªça ti·∫øt x∆∞·ªõc m·ªù) -->
                <div class="absolute inset-0 bg-[#080a08] overflow-hidden">
                    <div class="absolute w-[200%] h-[200%] top-[-50%] left-[-50%] opacity-20"
                        style="background-image: radial-gradient(circle, rgba(134, 239, 172, 0.4) 0%, transparent 60%);">
                    </div>
                    <!-- C√°c ch·∫•m s√°ng nh·ªè li ti -->
                    <div
                        class="absolute top-[20%] left-[10%] w-1 h-1 bg-cyber-green rounded-full shadow-[0_0_10px_#86efac]">
                    </div>
                    <div
                        class="absolute top-[60%] right-[15%] w-1.5 h-1.5 bg-cyber-green rounded-full shadow-[0_0_15px_#86efac] opacity-60">
                    </div>
                </div>

                <!-- T·∫•m th·∫ª n·ªôi dung ch√≠nh gi·ªØa m√†n h√¨nh -->
                <div class="absolute inset-0 p-6 flex flex-col items-center justify-center z-10">

                    <div class="glass-card w-full p-8 flex flex-col items-center shadow-2xl">
                        <!-- V·∫øt c·∫Øt gi·∫£ l·∫≠p ·ªü vi·ªÅn tr√™n t·∫•m th·∫ª -->
                        <div class="card-notch"></div>

                        <h2
                            class="text-4xl font-black text-cyber-green mb-8 text-center leading-tight tracking-tight mt-2 tracking-widest">
                            <br>
                        </h2>

                        <div
                            class="relative w-full aspect-square bg-cyber-green p-2 rounded-2xl shadow-[0_0_45px_rgba(134,239,172,0.35)] mb-8">

                            <!-- N∆°i m√£ QR hi·ªÉn th·ªã -->
                            <div id="qrcode"
                                class="w-full h-full bg-[#86efac] rounded-xl flex items-center justify-center overflow-hidden">
                            </div>

                        </div>

                        <!-- Th√¥ng tin ph·ª• -->
                        <div class="w-full flex flex-col items-center gap-2">
                            <p class="text-gray-400 text-xs uppercase tracking-widest font-semibold">M√£ ƒê·ªãnh Danh</p>
                            <p id="displayId" class="text-white text-lg font-bold tracking-wider">---</p>
                            <div class="h-[1px] w-1/2 bg-cyber-green/30 my-2"></div>
                            <p class="text-cyber-green text-xs opacity-80">QR SCAN ROLL CALL</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- N√∫t T·∫£i H√¨nh N·ªÅn & N√∫t Quay L·∫°i -->
            <div class="w-full flex gap-3 opacity-0 transform translate-y-4 transition-all duration-500 delay-300"
                id="action-buttons">
                <button onclick="resetForm()"
                    class="w-14 h-14 bg-[#111] hover:bg-[#222] border border-white/10 text-white rounded-2xl flex items-center justify-center flex-shrink-0 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>

                <button onclick="downloadWallpaper()" id="downloadBtn"
                    class="flex-1 bg-cyber-green hover:bg-cyber-neon active:scale-95 text-[#050505] rounded-2xl py-4 text-[16px] font-bold tracking-wide transition-all duration-300 flex items-center justify-center gap-2 shadow-[0_0_20px_rgba(74,222,128,0.3)]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    <span>L∆∞u H√¨nh N·ªÅn Kh√≥a</span>
                </button>
            </div>

        </div>
    </div>

    <!-- ü™Ñ Ph√©p thu·∫≠t Logic c·ªßa Trang -->
    <script>
        const studentInput = document.getElementById('studentId');
        const errorMsg = document.getElementById('errorMessage');
        const inputSection = document.getElementById('input-section');
        const wallpaperWrapper = document.getElementById('wallpaper-wrapper');
        const wallpaperPreview = document.getElementById('wallpaper-preview');
        const actionButtons = document.getElementById('action-buttons');
        const qrcodeElement = document.getElementById('qrcode');
        const displayId = document.getElementById('displayId');

        let qrCodeObj = null;

        studentInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') generateWallpaper();
        });

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.remove('opacity-0');
            studentInput.classList.add('border-cyber-green/50');
            setTimeout(() => {
                errorMsg.classList.add('opacity-0');
                studentInput.classList.remove('border-cyber-green/50');
            }, 3000);
        }

        function generateWallpaper() {
            const text = studentInput.value.replace(/\s+/g, '');

            if (!text) {
                showError('‚ùÄ Nh·∫≠p m√£ sinh vi√™n ƒë·ªÉ Trang l√†m h√¨nh n·ªÅn nh√©!');
                return;
            }

            // C·∫≠p nh·∫≠t text hi·ªÉn th·ªã tr√™n th·∫ª
            displayId.textContent = text;

            // X√≥a m√£ QR c≈©
            qrcodeElement.innerHTML = '';

            try {
                // Trang "b·∫Øt m·∫°ch" l·ªói n√†y: Camera ch·ªâ ƒë·ªçc ƒëi·ªÉm t·ªëi tr√™n n·ªÅn s√°ng (Dark on Light).
                // Ph·∫£i ƒë·ªïi ch·∫•m QR th√†nh m√†u ƒêEN s√¢u, n·ªÅn XANH NEON s√°ng th√¨ m·ªõi v·ª´a cyberpunk v·ª´a qu√©t c·ª±c nh·∫°y!
                qrCodeObj = new QRCode(qrcodeElement, {
                    text: text,
                    width: 512,
                    height: 512,
                    colorDark: "#050505",
                    colorLight: "#86efac",
                    correctLevel: QRCode.CorrectLevel.M
                });

                // Chuy·ªÉn ƒë·ªïi m√†n h√¨nh: ·∫®n form nh·∫≠p, Hi·ªán Wallpaper
                inputSection.classList.add('opacity-0', 'scale-95', 'pointer-events-none', 'hidden');
                wallpaperWrapper.classList.remove('hidden');

                // K√≠ch ho·∫°t hi·ªáu ·ª©ng xu·∫•t hi·ªán m·ªÅm m·∫°i
                setTimeout(() => {
                    wallpaperPreview.classList.add('show');
                    actionButtons.classList.remove('opacity-0', 'translate-y-4');
                }, 50);

            } catch (error) {
                showError('‚ùÄ D·ªØ li·ªáu ƒëang b·ªã qu√° t·∫£i, anh th·ª≠ r√∫t g·ªçn l·∫°i nha...');
            }
        }

        function resetForm() {
            // Quay l·∫°i m√†n h√¨nh nh·∫≠p li·ªáu
            wallpaperPreview.classList.remove('show');
            actionButtons.classList.add('opacity-0', 'translate-y-4');

            setTimeout(() => {
                wallpaperWrapper.classList.add('hidden');
                inputSection.classList.remove('hidden');
                setTimeout(() => {
                    inputSection.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
                }, 50);
            }, 500);
        }

        // ‚ùÄ Ph√©p thu·∫≠t xu·∫•t ·∫£nh t·ª´ HTML c·ªßa Trang ‚ùÄ
        function downloadWallpaper() {
            const btn = document.getElementById('downloadBtn');
            const originalText = btn.innerHTML;

            // ƒê·ªïi tr·∫°ng th√°i n√∫t ƒë·ªÉ b√°o cho anh Ho√†ng bi·∫øt Trang ƒëang x·ª≠ l√Ω
            btn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ƒêang n√©n nƒÉng l∆∞·ª£ng...`;

            // D√πng html2canvas ƒë·ªÉ ch·ª•p l·∫°i kh·ªëi #wallpaper-preview
            html2canvas(wallpaperPreview, {
                scale: 3, // Ph√≥ng to g·∫•p 3 l·∫ßn ƒë·ªÉ ·∫£nh n√©t cƒÉng nh∆∞ Sony!
                useCORS: true,
                backgroundColor: '#080a08' // ƒê·∫£m b·∫£o n·ªÅn m√†u ƒëen s√¢u
            }).then(canvas => {
                // T·∫°o link t·∫£i ·∫£nh
                const link = document.createElement('a');
                link.download = `LockScreen_${studentInput.value.replace(/\s+/g, '')}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();

                // Tr·∫£ l·∫°i tr·∫°ng th√°i n√∫t
                btn.innerHTML = originalText;
            }).catch(err => {
                alert("‚ùÄ Trang xin l·ªói, c√≥ ch√∫t tr·ª•c tr·∫∑c khi t·∫°o ·∫£nh r·ªìi ·∫°!");
                btn.innerHTML = originalText;
            });
        }
    </script>
</body>

</html>
